<style>
.fader-control {
    display: flex;
    flex-direction: row;
    flex-wrap: wrap;
    justify-content: space-between;
    max-width: 25rem;

    /* Padding is used to offset the centering of the ticks against the range.
       It should correspond to radius of the range handle. */
    padding-left: 0.4375rem;
    padding-right: 0.4375rem;
}

.fader-control > label {
    order: 0;
    width: calc(100% - 2.5625rem);
    margin-left: -0.4375rem;
    font-size: 0.8125rem;
}

.fader-control > output {
    order: 1;
    width: 3.4375rem;
    margin-right: -0.4375rem;
    font-size: 0.8125rem;
    text-align: right;
}

.fader-control > .tick {
    order: 2;
    position: relative;
    width: 2.0625rem;
    margin-top: 0.375rem;
    margin-left: -1rem;
    margin-right: -1rem;
    font-size: 10px;
    text-align: center;
    overflow: visible;
    z-index: 0;

    /* Make room for tick mark */
    /*padding-bottom: 3px;*/
}

.fader-control > .tick::after {
    content: '';
    position: absolute;
    left: 1rem;
    bottom: -4px;
    /* Or place the ticks underneath the range */
    /*bottom: -24px;*/
    width: 1px;
    height: 3px;
    background-color: black;
}

.fader-control > [type="range"] {
    order: 3;
    /* -ve margin left and right is used to offset the centering range against
       its ticks. It should correspond to radius of the range handle. */
    margin: 0.125rem -0.4375rem;
    width: calc(100% + 0.875rem);
    z-index: 1;
}

.fader-control + .fader-control {
    margin-top: 0.5625rem;
}
</style>

<template id="control-tick">
    <input class="masked" type="radio" name="fader-{[..id]}-tick-{[1]}" id="fader-{[..id]}-tick-{[1]}" value="{[1]}" sparky-value="{[..value|float-string]}"/>
    <label for="fader-{[..id]}-tick-{[1]}">{[1]}</label>
</template>

<template id="fader-control">
    <div class="fader-control" fn="fader-control">
    <label for="{[id]}">{[label]}</label>
    <div class="tick" fn="get:ticks entries template:#control-tick each"></div>
    <!--template fn="each" src="#control-tick"></template-->
    <input type="range" name="{[id]}-{[name]}" id="{[id]}" value="{[value]}" min="{[min]}" max="{[max]}" />
    <output>{[value]}<abbr>{[unit]}</abbr></output>
    </div>
</template>

<script type="module" title="fader">
import { cache, Observer, observe, set } from '../../../fn/fn.js';
import Sparky from '../../../sparky/sparky.js';

let id = 0;
console.log('RUN')
const toFaderScope = cache(function(param) {
    const scope = Observer({
        id:        id++,
        name:      'fader',
        label:     'Volume',
        value:     20,
        min:       0,
        max:       100,
        unit:      'dB',
        transform: '',
        ticks:     [0, 25, 50, 75, 100]
    });

    observe('value', set('value', scope), param);
    observe('value', set('value', param), scope);

    return scope;
});

Sparky.fn['fader-control'] = function(node, scopes, params) {
    console.log('Sparky fader-control');
    return scopes.map(toFaderScope);
};
</script>
